# 4. Application Scopes

Application scopes are used to group components together into logical applications by providing different forms of application boundaries with common group behaviors.

Application scopes have the following general characteristics:

- Application scopes SHOULD be used when defining behavior or metadata that is common to a group of component instances.
- A component MAY be deployed into multiple application scopes of different types simultaneously. 
- Application scope types MAY determine whether or not components can be deployed into multiple instances of the same application scope type simultaneously. 
- Application scopes MAY be used as a connecting mechanism between groups of components and capabilities provided by infrastructure, such as networking, or external capabilities, such as identity providers.

The following diagram illustrates how components can be grouped into overlapping application scopes to create different application boundaries:

![Scope diagram][scope-diagram-1]

This example shows two scope types with four components distributed among them.

Components A, B, and C are deployed to the same health scope. The health scope will collect aggregate health information on its constituent components that is evaluated during component upgrade operations. Query information provided by the health scope can be further used by traits or components that need to evaluate and/or perform actions based on the aggregate health of a set of components. This is a basic grouping construct for applications that provides a loose definition of dependencies between components.

Component A is isolated in its own network scope from components B, C, and D. This allows the infrastructure operator to supply different SDN settings for different groups of components, such as more restricted inbound/outbound rules on back-end components.

## Categories of application scope types

The application scope system is designed to serve as an extension point for runtime operational capability while also providing common, and in some cases, necessary operational functionality for components. Application scope types are grouped based on the standard namespace grouping defined [here](2.overview_and_terminology.md#extending-hydra).

The implementation details of a application scopes is beyond the scope of this document.

### Core application scope types

Core application scope types define grouping constructs for basic runtime behavior. They have the following characteristics:

- Core application scope types MUST be in the `core.hydra.io` namespace.
- Core application scope types MUST all be supported by any implementation of the specification. They may be implemented by any available feature in the platform, but they MUST be implemented according to the specification of each core application scope type.
- Instances of core *workload* types MUST be deployed into an instance of each core application scope type.
- Runtimes MUST provide a default "root" application scope instance for each core application scope type.
- Runtimes MUST deploy each component instances into default "root" application scope instances when an application configuration does not otherwise specify an application scope for a component instance.

Core application scopes are defined are defined in the [core/application_scope](core/application_scope.md) document.

### Standard and extended application scope types

Standard and extended application scopes are recommended / optional per runtime, meaning that each runtime may choose which standard and extended application scopes are supported. In the present version of the spec, allowing user-defined extended application scope types is _not supported_.

Standard and extended application scopes are defined are defined in the [standard/application_scopes](standard/application_scopes.md) and [extended/application_scopes](extended/application_scopes/readme.md) folders.

## Defining an application scope

This section is normative because application scopes are an inspectable (and possibly shareable) part of the system. All scopes MUST be representable in the following format.

Application scopes are defined with schematics like components and traits.

### Top-Level Attributes

The following attributes are common across all schemata defined in this document. This structure is designed to allow object type to be determined by scanning two fields (`apiVersion` and `kind`), and provide access to common fields in the `metadata` section. The `spec` section is where type-specific information is located, and in this section the `spec` section defines a `Scope`.

| Attribute | Type | Required | Default Value | Description |
|-----------|------|----------|---------------|-------------|
| `apiVersion` | `string` | Y || The specific version of the Hydra specification in use. This version of the specification covers apiVersions in `core.hydra.io/v1alpha1`. |
| `kind` | `string` | Y || For a scope schematic, must be `ApplicationScope`. |
| `metadata` | [`Metadata`](2.overview_and_terminology.md#metadata) | Y | | Scope metadata. |
| `spec`| [`Spec`](#spec) | Y || A container for all remaining attributes. |

### Spec

The spec defines the constituent parts of a scope.

| Attribute | Type | Required | Default Value | Description |
|-----------|------|----------|---------------|-------------|
| `type` | `string` | Y | | Determines type of the application scope. The core types are defined [here](core/application-scopes.md) |
| `allowComponentOverlap` | `bool` | Y | | Determines whether a component is allowed to be in multiple instances of this scope type simultaneously. When false, the runtime implementation MUST produce an error and stop deployment if an attempt is made to place a component into more than one instance of this scope type simultaneously. |
| `parameters` | [`[]Parameter`](#parameter) | N | | The scope's configuration options. |

The `type` field defines the type name for this type. Examples may be found in the [Core Application Scope Types](core/application-scopes.md). Other scope types MUST NOT be in the `core.hydra.io` namespace.  However, they must follow the [group, version, kind notation](2.overview_and_terminology.md).

#### Parameter

The parameters that a scope exposes to operators.

| Attribute | Type | Required | Default Value | Description |
|-----------|------|----------|---------------|-------------|
| `name` | `string` | Y | | The parameter's name. Must be unique per scope. |
| `description` | `string` | N | | A description of the parameter. |
| `type` | `string` | Y | | The parameter's type (One of `string`, `boolean`, `number`). |
| `required` | `boolean` | N |`false` | Whether a value _must_ be provided for the parameter. |
| `default` | type indicated by `type` field | N | | The parameter's default value. |

The `name` field allows Unicode letters, numbers and `_` and `-`. The `description` field allows those characters plus whitespace and punctuation characters.

## Deployment

Application scope instances are defined and deployed in an application configuration. See [Application Configuration](6.application_configuration.md) for more information on deploying scopes.

## Application Scope Definitions

- Core application scopes are defined in the [core/application-scopes.md](core/application-scopes.md) document.
- Standard application scopes are defined in the [standard/application-scopes.md](standard/application-scopes.md) document.
- Extended application scopes are defined in the [extended/application-scopes/readme.md](extended/application-scopes/readme.md) document.

[scope-diagram-1]: assets/scopes-diagram-1.png

| Previous Part        | Next Part           |
| ------------- |-------------|
| [3. The Component Model](3.component_model.md)     | [5. Traits](5.traits.md) |
