# 5. Traits

A _trait_ is a discretionary runtime overlay that augments a component workload type (`workloadType`) with additional features. It is an opportunity for those in the _application operator_ role to make specific decisions about the configuration of components, but without involving the developer. A trait can be any configuration of a distributed application that applies to an individual component, such as traffic routing rules (e.g., load balancing policy, network ingress routing, circuit breaking, rate limiting), auto-scaling policies, upgrade strategies, and more.

The _traits system_ is defined in this specification as the way a runtime applies and manages operational behaviors to instances of components through traits.

Runtime implementations of the specification MUST provide the traits system for attaching operational behaviors to instances of components.

## Traits system rules and characteristics

Traits are applied to component instances in the [application configuration](6.application_configuration.md).

Traits should be applied into the runtime at installation/upgrade time. Traits should not be checked "lazily", but should be checked when the trait-holding components are created.

When more than one trait is attached to a component, it MUST:

- Apply the traits in the defined order
- Determine compatibility, and fail if the combination of traits cannot be satisfied

Traits are applied in order so that should some set of traits express dependency (e.g. ingress must be set up before SSL), this can be resolved by setting an explicit ordering.

A component instance may only have one configuration of any given trait type.

A deployment SHOULD NOT be marked complete until all trait configurations are completed. For example, if a web server component is deployed with an autoscaler trait, the web server should not be considered "running" until (a) the web server itself is running, as determined by health checks, and (b) the autoscaler trait is running, as determined by the underlying platform.

Components can specify multiple traits, therefore a runtime MUST support the application of zero or more traits to a component. A runtime MUST produce an error and stop deployment if the requested traits cannot be fulfilled by the underlying runtime.

There is no mechanism for explicitly requiring a combination of traits. For example, a trait (`ssl`) cannot specify that it requires that another trait (`ingress`) be applied to an object. However, _implementations_ of a trait SHOULD fail if one trait cannot fulfill its contract without the presence of another trait. A system MAY support a mechanism in which a trait (`sslIngress`) is opaquely backed by two separate trait implementations (`ssl` and `ingress`).

Any trait that is made available in a runtime MUST be implemented for that runtime. For example, there cannot be a trait for `autoscaling` in a runtime with no implementation of that trait.

## Categories of traits

The traits system is designed to serve as an extension point for runtime operational capability while also providing common, and in some cases, necessary operational functionality for components.

The implementation details of a trait is beyond the scope of this document. However, to allow runtimes to implement arbitrary traits while maintaining a degree commonality for application portability across runtimes, traits are categorized using the [standard grouping](2.overview_and_terminology.md#extending-hydra) in the `hydra.io` namespace.

## Trait characteristics

An individual trait MAY be tied to specific workload types (or MAY apply to all workload types). A trait MAY declare which workload types it applies to. For example, an autoscaler trait could apply to a workload type _Service_, but not to type _Singleton Service_. The autoscaler trait itself MUST define that restriction if present.

The specification does not set requirements about how simple or complicated a trait may be. Some might expose an expansive set of configurable options while others may expose no configurable options. And it is not required that a trait be as exhaustive as its underlying technology. For example, an implementation of an autoscaling technology may provide numerous ways of determining when a component should scale. But the trait may only surface a few of those. Likewise, multiple autoscaling traits may be defined (each uniquely named), where each trait exposes a different subset of configurable options. Or one large trait may expose all of the possible autoscaling configurations.

Implementations of the Hydra runtime SHOULD make all supported traits discoverable in the format explained below.

## Trait definition

This section is normative because traits are an inspectable (and possibly shareable) part of the system. All traits MUST be representable in the following format.

Traits are defined with schematics like components. Unlike component schematics, however, each trait definition defines its own unique [properties]((#properties) object schema to define the configuration options for the trait.  

### Top-Level Attributes

The top-level attributes of a trait define its metadata, version, kind, and spec.

| Attribute | Type | Required | Default Value | Description |
|-----------|------|----------|---------------|-------------|
| `apiVersion` | `string` | Y || The specific version of the specification in use. At present only `core.hydra.io/v1alpha1` is defined. |
| `kind` | `string` | Y || The string `Trait` |
| `metadata` | [`Metadata`](2.overview_and_terminology.md#metadata) | Y | | Trait metadata. |
| `spec`| [`Spec`](#spec) | Y || A specification for trait attributes. |

#### Spec

The specification defines two major things: The list of workload types to which this trait applies, and the list of configurable parameters on this trait.

| Attribute | Type | Required | Default Value | Description |
|-----------|------|----------|---------------|-------------|
| `appliesTo` | `[]string` | Y | `["*"]` | The list of workload types that this trait applies to. `"*"` means _any workload type_. A trait must apply to at least one workload type. This attribute must contain at least one value. An empty array is invalid for this attribute. |
| `properties` | [`JSON Schema`](#properties) | Y | | A [JSON schema](https://json-schema.org/) expressed as inline YAML for the trait's configuration options. |

##### Properties

A properties object is an object whose structure is determined by the trait property schema. It may be a simple value, or it may be a complex object.

The value of the properties field in a trait definition is a [JSON schema](https://json-schema.org/) expressed as inline YAML. When a trait is applied to a component instance, the properties are validated against the schema defined in the trait's `properties` attribute.

For example, if a trait defines a schema for properties that requires an array of integers with at least one member, the properties object is expected to be an array of integers with at least one member. During validation of the properties object, the trait's property schema will be applied.

## Traits definitions

- Core traits are defined in the [core/traits.md](core/traits.md) document.
- Standard traits are defined in the [standard/traits.md](standard/traits.md) document.
- Extended traits are defined in the [extended/traits/readme.md](extended/traits/readme.md) document.

| Previous Part        | Next Part           |
| ------------- |-------------|
| [4. Application Scopes](4.application_scopes.md) | [6. Application Configuration](6.application_configuration.md) |
